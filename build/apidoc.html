<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="http://github.com/mashpie/i18n-node"

    >i18n (v0.8.3)</a>
</h1>
<h4>lightweight translation module with dynamic json storage</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.i18n">module i18n</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.i18n.__">
            function <span class="apidocSignatureSpan">i18n.</span>__
            <span class="apidocSignatureSpan">(phrase)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.i18n.__h">
            function <span class="apidocSignatureSpan">i18n.</span>__h
            <span class="apidocSignatureSpan">(phrase)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.i18n.__l">
            function <span class="apidocSignatureSpan">i18n.</span>__l
            <span class="apidocSignatureSpan">(phrase)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.i18n.__mf">
            function <span class="apidocSignatureSpan">i18n.</span>__mf
            <span class="apidocSignatureSpan">(phrase)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.i18n.__n">
            function <span class="apidocSignatureSpan">i18n.</span>__n
            <span class="apidocSignatureSpan">(singular, plural, count)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.i18n.addLocale">
            function <span class="apidocSignatureSpan">i18n.</span>addLocale
            <span class="apidocSignatureSpan">(locale)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.i18n.configure">
            function <span class="apidocSignatureSpan">i18n.</span>configure
            <span class="apidocSignatureSpan">(opt)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.i18n.getCatalog">
            function <span class="apidocSignatureSpan">i18n.</span>getCatalog
            <span class="apidocSignatureSpan">(object, locale)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.i18n.getLocale">
            function <span class="apidocSignatureSpan">i18n.</span>getLocale
            <span class="apidocSignatureSpan">(request)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.i18n.getLocales">
            function <span class="apidocSignatureSpan">i18n.</span>getLocales
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.i18n.init">
            function <span class="apidocSignatureSpan">i18n.</span>init
            <span class="apidocSignatureSpan">(request, response, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.i18n.removeLocale">
            function <span class="apidocSignatureSpan">i18n.</span>removeLocale
            <span class="apidocSignatureSpan">(locale)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.i18n.setLocale">
            function <span class="apidocSignatureSpan">i18n.</span>setLocale
            <span class="apidocSignatureSpan">(object, locale, skipImplicitObjects)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">i18n.</span>locales</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">i18n.</span>version</span>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.i18n" id="apidoc.module.i18n">module i18n</a></h1>


    <h2>
        <a href="#apidoc.element.i18n.__" id="apidoc.element.i18n.__">
        function <span class="apidocSignatureSpan">i18n.</span>__
        <span class="apidocSignatureSpan">(phrase)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function i18nTranslate(phrase) {
  var msg;
  var argv = parseArgv(arguments);
  var namedValues = argv[0];
  var args = argv[1];

  // called like __({phrase: &#x22;Hello&#x22;, locale: &#x22;en&#x22;})
  if (typeof phrase === &#x27;object&#x27;) {
    if (typeof phrase.locale === &#x27;string&#x27; &#x26;&#x26; typeof phrase.phrase === &#x27;string&#x27;) {
      msg = translate(phrase.locale, phrase.phrase);
    }
  }
  // called like __(&#x22;Hello&#x22;)
  else {
    // get translated message with locale from scope (deprecated) or object
    msg = translate(getLocaleFromObject(this), phrase);
  }

  // postprocess to get compatible to plurals
  if (typeof msg === &#x27;object&#x27; &#x26;&#x26; msg.one) {
    msg = msg.one;
  }

  // in case there is no &#x27;one&#x27; but an &#x27;other&#x27; rule
  if (typeof msg === &#x27;object&#x27; &#x26;&#x26; msg.other) {
    msg = msg.other;
  }

  // head over to postProcessing
  return postProcess(msg, namedValues, args);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```js
i18n.configure({
    locales:[&#x27;en&#x27;, &#x27;de&#x27;],
    directory: __dirname + &#x27;/locales&#x27;
});
```
now you are ready to use a global `i18n.<span class="apidocCodeKeywordSpan">__</span>(&#x27;Hello&#x27;)`.

## Example usage in global scope

In your cli, when not registered to a specific object:

```js
var greeting = i18n.__(&#x27;Hello&#x27;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.i18n.__h" id="apidoc.element.i18n.__h">
        function <span class="apidocSignatureSpan">i18n.</span>__h
        <span class="apidocSignatureSpan">(phrase)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function i18nTranslationHash(phrase) {
  var translations = [];
  Object.keys(locales).sort().forEach(function(l) {
    var hash = {};
    hash[l] = i18n.__({ phrase: phrase, locale: l });
    translations.push(hash);
  });
  return translations;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
app.get( __l(&#x27;/:locale/products/:id?&#x27;), function (req, res) {
    // guess what you might use req.params.locale for?
});
```

&#x3e; i18n.__ln() to get plurals will come up in another release...

### i18n.<span class="apidocCodeKeywordSpan">__h</span>()

Returns a hashed list of translations for a given phrase in each language.

```js
i18n.__h(&#x27;Hello&#x27;); // --&#x3e; [ { de: &#x27;Hallo&#x27; }, { en: &#x27;Hello&#x27; } ]
```
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.i18n.__l" id="apidoc.element.i18n.__l">
        function <span class="apidocSignatureSpan">i18n.</span>__l
        <span class="apidocSignatureSpan">(phrase)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function i18nTranslationList(phrase) {
  var translations = [];
  Object.keys(locales).sort().forEach(function(l) {
    translations.push(i18n.__({ phrase: phrase, locale: l }));
  });
  return translations;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

* Simple Variable Replacement (similar to mustache placeholders)
* SelectFormat (ie. switch msg based on gender)
* PluralFormat (see above and [ranges](#ranged-interval-support))

Combinations of those give superpower, but should get tested well (contribute your use case, please!) on integration.

### i18n.<span class="apidocCodeKeywordSpan">__l</span>()

Returns a list of translations for a given phrase in each language.

```js
i18n.__l(&#x27;Hello&#x27;); // --&#x3e; [ &#x27;Hallo&#x27;, &#x27;Hello&#x27; ]
```
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.i18n.__mf" id="apidoc.element.i18n.__mf">
        function <span class="apidocSignatureSpan">i18n.</span>__mf
        <span class="apidocSignatureSpan">(phrase)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function i18nMessageformat(phrase) {
  var msg, mf, f;
  var targetLocale = defaultLocale;
  var argv = parseArgv(arguments);
  var namedValues = argv[0];
  var args = argv[1];

  // called like __({phrase: &#x22;Hello&#x22;, locale: &#x22;en&#x22;})
  if (typeof phrase === &#x27;object&#x27;) {
    if (typeof phrase.locale === &#x27;string&#x27; &#x26;&#x26; typeof phrase.phrase === &#x27;string&#x27;) {
      msg = phrase.phrase;
      targetLocale = phrase.locale;
    }
  }
  // called like __(&#x22;Hello&#x22;)
  else {
    // get translated message with locale from scope (deprecated) or object
    msg = phrase;
    targetLocale = getLocaleFromObject(this);
  }

  msg = translate(targetLocale, msg);
  // --- end get msg

  // now head over to Messageformat
  // and try to cache instance
  if (MessageformatInstanceForLocale[targetLocale]) {
    mf = MessageformatInstanceForLocale[targetLocale];
  } else {
    mf = new Messageformat(targetLocale);
    mf.compiledFunctions = {};
    MessageformatInstanceForLocale[targetLocale] = mf;
  }

  // let&#x27;s try to cache that function
  if (mf.compiledFunctions[msg]) {
    f = mf.compiledFunctions[msg];
  } else {
    f = mf.compile(msg);
    mf.compiledFunctions[msg] = f;
  }

  return postProcess(f(namedValues), namedValues, args);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
__n(&#x27;%s cat&#x27;, 5); // --&#x3e; 5 кошек
__n(&#x27;%s cat&#x27;, 6); // --&#x3e; 6 кошек
__n(&#x27;%s cat&#x27;, 21); // --&#x3e; 21 кошка
```

&#x3e; __Note__ i18n.__n() will add a blueprint (&#x22;one, other&#x22; or &#x22;one, few, other&#x22; for eaxmple) for each locale
 to your json on updateFiles in a future version.

### i18n.<span class="apidocCodeKeywordSpan">__mf</span>()

Supports the advanced MessageFormat as provided by excellent [messageformat module](https://www.npmjs.com/package/messageformat).
You should definetly head over to [messageformat.github.io](https://messageformat.github.io) for a guide to MessageFormat. i18n
takes care of `new MessageFormat(&#x27;en&#x27;).compile(msg);` with the current `msg` loaded from it&#x27;s json files and cache
 that complied fn in memory. So in short you might use it similar to `__()` plus extra object to accomblish MessageFormat&#x27;s
 formating. Ok, some examples:

```js
// assume res is set to german
res.setLocale(&#x27;de&#x27;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.i18n.__n" id="apidoc.element.i18n.__n">
        function <span class="apidocSignatureSpan">i18n.</span>__n
        <span class="apidocSignatureSpan">(singular, plural, count)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function i18nTranslatePlural(singular, plural, count) {
  var msg, namedValues, targetLocale, args = [];

  // Accept an object with named values as the last parameter
  if (argsEndWithNamedObject(arguments)) {
    namedValues = arguments[arguments.length - 1];
    args = arguments.length &#x3e;= 5 ? Array.prototype.slice.call(arguments, 3, -1) : [];
  } else {
    namedValues = {};
    args = arguments.length &#x3e;= 4 ? Array.prototype.slice.call(arguments, 3) : [];
  }

  // called like __n({singular: &#x22;%s cat&#x22;, plural: &#x22;%s cats&#x22;, locale: &#x22;en&#x22;}, 3)
  if (typeof singular === &#x27;object&#x27;) {
    if (
      typeof singular.locale === &#x27;string&#x27; &#x26;&#x26;
      typeof singular.singular === &#x27;string&#x27; &#x26;&#x26;
      typeof singular.plural === &#x27;string&#x27;
    ) {
      targetLocale = singular.locale;
      msg = translate(singular.locale, singular.singular, singular.plural);
    }
    args.unshift(count);

    // some template engines pass all values as strings -&#x3e; so we try to convert them to numbers
    if (typeof plural === &#x27;number&#x27; || parseInt(plural, 10) + &#x27;&#x27; === plural) {
      count = plural;
    }

    // called like __n({singular: &#x22;%s cat&#x22;, plural: &#x22;%s cats&#x22;, locale: &#x22;en&#x22;, count: 3})
    if (typeof singular.count === &#x27;number&#x27; || typeof singular.count === &#x27;string&#x27;) {
      count = singular.count;
      args.unshift(plural);
    }
  } else {
    // called like  __n(&#x27;cat&#x27;, 3)
    if (typeof plural === &#x27;number&#x27; || parseInt(plural, 10) + &#x27;&#x27; === plural) {
      count = plural;

      // we add same string as default
      // which efectivly copies the key to the plural.value
      // this is for initialization of new empty translations
      plural = singular;

      args.unshift(count);
      args.unshift(plural);
    }
    // called like __n(&#x27;%s cat&#x27;, &#x27;%s cats&#x27;, 3)
    // get translated message with locale from scope (deprecated) or object
    msg = translate(getLocaleFromObject(this), singular, plural);
    targetLocale = getLocaleFromObject(this);
  }

  if (count === null) count = namedValues.count;

  // enforce number
  count = parseInt(count, 10);

  // find the correct plural rule for given locale
  if (typeof msg === &#x27;object&#x27;) {
    var p;
    // create a new Plural for locale
    // and try to cache instance
    if (PluralsForLocale[targetLocale]) {
      p = PluralsForLocale[targetLocale];
    } else {
      // split locales with a region code
      var lc = targetLocale.toLowerCase().split(/[_-\s]+/)
        .filter(function(el){ return true &#x26;&#x26; el; });
      // take the first part of locale, fallback to full locale
      p = new MakePlural(lc[0] || targetLocale);
      PluralsForLocale[targetLocale] = p;
    }

    // fallback to &#x27;other&#x27; on case of missing translations
    msg = msg[p(count)] || msg.other;
  }

  // head over to postProcessing
  return postProcess(msg, namedValues, args, count);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

// passing specific locale
__({phrase: &#x27;Hello&#x27;, locale: &#x27;fr&#x27;}); // Salut
__({phrase: &#x27;Hello %s&#x27;, locale: &#x27;fr&#x27;}, &#x27;Marcus&#x27;); // Salut Marcus
__({phrase: &#x27;Hello function <span class="apidocSignatureSpan">i18n.</span>__n&#x27;, locale: &#x27;fr&#x27;}, { name: &#x27;Marcus&#x27; }); // Salut Marcus
```

### i18n.<span class="apidocCodeKeywordSpan">__n</span>()

Plurals translation of a single phrase. Singular and plural forms will get added to locales if unknown. Returns translated parsed
 and substituted string based on last `count` parameter.

```js
// short syntax is best suited for reading
// --&#x3e; writes &#x27;%s cat&#x27; to both `one` and `other` plurals
__n(&#x27;%s cat&#x27;, 1) // --&#x3e; 1 Katze
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.i18n.addLocale" id="apidoc.element.i18n.addLocale">
        function <span class="apidocSignatureSpan">i18n.</span>addLocale
        <span class="apidocSignatureSpan">(locale)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function i18nAddLocale(locale) {
  read(locale);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.i18n.configure" id="apidoc.element.i18n.configure">
        function <span class="apidocSignatureSpan">i18n.</span>configure
        <span class="apidocSignatureSpan">(opt)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function i18nConfigure(opt) {

  // reset locales
  locales = {};

  // Provide custom API method aliases if desired
  // This needs to be processed before the first call to applyAPItoObject()
  if (opt.api &#x26;&#x26; typeof opt.api === &#x27;object&#x27;) {
    for (var method in opt.api) {
      if (opt.api.hasOwnProperty(method)) {
        var alias = opt.api[method];
        if (typeof api[method] !== &#x27;undefined&#x27;) {
          api[method] = alias;
        }
      }
    }
  }

  // you may register i18n in global scope, up to you
  if (typeof opt.register === &#x27;object&#x27;) {
    register = opt.register;
    // or give an array objects to register to
    if (Array.isArray(opt.register)) {
      register = opt.register;
      register.forEach(function(r) {
        applyAPItoObject(r);
      });
    } else {
      applyAPItoObject(opt.register);
    }
  }

  // sets a custom cookie name to parse locale settings from
  cookiename = (typeof opt.cookie === &#x27;string&#x27;) ? opt.cookie : null;

  // query-string parameter to be watched - @todo: add test &#x26; doc
  queryParameter = (typeof opt.queryParameter === &#x27;string&#x27;) ? opt.queryParameter : null;

  // where to store json files
  directory = (typeof opt.directory === &#x27;string&#x27;) ?
    opt.directory : path.join(__dirname, &#x27;locales&#x27;);

  // permissions when creating new directories
  directoryPermissions = (typeof opt.directoryPermissions === &#x27;string&#x27;) ?
    parseInt(opt.directoryPermissions, 8) : null;

  // write new locale information to disk
  updateFiles = (typeof opt.updateFiles === &#x27;boolean&#x27;) ? opt.updateFiles : true;

  // sync locale information accros all files
  syncFiles = (typeof opt.syncFiles === &#x27;boolean&#x27;) ? opt.syncFiles : false;

  // what to use as the indentation unit (ex: &#x22;\t&#x22;, &#x22;  &#x22;)
  indent = (typeof opt.indent === &#x27;string&#x27;) ? opt.indent : &#x27;\t&#x27;;

  // json files prefix
  prefix = (typeof opt.prefix === &#x27;string&#x27;) ? opt.prefix : &#x27;&#x27;;

  // where to store json files
  extension = (typeof opt.extension === &#x27;string&#x27;) ? opt.extension : &#x27;.json&#x27;;

  // setting defaultLocale
  defaultLocale = (typeof opt.defaultLocale === &#x27;string&#x27;) ? opt.defaultLocale : &#x27;en&#x27;;

  // auto reload locale files when changed
  autoReload = (typeof opt.autoReload === &#x27;boolean&#x27;) ? opt.autoReload : false;

  // enable object notation?
  objectNotation = (typeof opt.objectNotation !== &#x27;undefined&#x27;) ? opt.objectNotation : false;
  if (objectNotation === true) objectNotation = &#x27;.&#x27;;

  // read language fallback map
  fallbacks = (typeof opt.fallbacks === &#x27;object&#x27;) ? opt.fallbacks : {};

  // setting custom logger functions
  logDebugFn = (typeof opt.logDebugFn === &#x27;function&#x27;) ? opt.logDebugFn : debug;
  logWarnFn = (typeof opt.logWarnFn === &#x27;function&#x27;) ? opt.logWarnFn : warn;
  logErrorFn = (typeof opt.logErrorFn === &#x27;function&#x27;) ? opt.logErrorFn : error;

  // when missing locales we try to guess that from directory
  opt.locales = opt.locales || guessLocales(directory);

  // implicitly read all locales
  if (Array.isArray(opt.locales)) {

    opt.locales.forEach(function(l) {
      read(l);
    });

    // auto reload locale files when changed
    if (autoReload) {

      // watch changes of locale files (it&#x27;s called twice because fs.watch is still unstable)
      fs.watch(directory, function(event, filename) {
        var localeFromFile = guessLocaleFromFile(filename);

        if (localeFromFile &#x26;&#x26; opt.locales.indexOf(localeFromFile) &#x3e; -1) {
          logDebug(&#x27;Auto reloading locale file &#x22;&#x27; + filename + &#x27;&#x22;.&#x27;);
          read(localeFromFile);
        }

      });
    }
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
```

## Configure

Minimal example, just setup two locales and a project specific directory

```js
i18n.<span class="apidocCodeKeywordSpan">configure</span>({
    locales:[&#x27;en&#x27;, &#x27;de&#x27;],
    directory: __dirname + &#x27;/locales&#x27;
});
```
now you are ready to use a global `i18n.__(&#x27;Hello&#x27;)`.

## Example usage in global scope
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.i18n.getCatalog" id="apidoc.element.i18n.getCatalog">
        function <span class="apidocSignatureSpan">i18n.</span>getCatalog
        <span class="apidocSignatureSpan">(object, locale)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function i18nGetCatalog(object, locale) {
  var targetLocale;

  // called like i18n.getCatalog(req)
  if (typeof object === &#x27;object&#x27; &#x26;&#x26; typeof object.locale === &#x27;string&#x27; &#x26;&#x26; locale === undefined) {
    targetLocale = object.locale;
  }

  // called like i18n.getCatalog(req, &#x27;en&#x27;)
  if (!targetLocale &#x26;&#x26; typeof object === &#x27;object&#x27; &#x26;&#x26; typeof locale === &#x27;string&#x27;) {
    targetLocale = locale;
  }

  // called like req.getCatalog(&#x27;en&#x27;)
  if (!targetLocale &#x26;&#x26; locale === undefined &#x26;&#x26; typeof object === &#x27;string&#x27;) {
    targetLocale = object;
  }

  // called like req.getCatalog()
  if (!targetLocale &#x26;&#x26;
    object === undefined &#x26;&#x26;
    locale === undefined &#x26;&#x26;
    typeof this.locale === &#x27;string&#x27;
  ) {
    if (register &#x26;&#x26; register.GLOBAL) {
      targetLocale = &#x27;&#x27;;
    } else {
      targetLocale = this.locale;
    }
  }

  // called like i18n.getCatalog()
  if (targetLocale === undefined || targetLocale === &#x27;&#x27;) {
    return locales;
  }

  if (!locales[targetLocale] &#x26;&#x26; fallbacks[targetLocale]) {
    targetLocale = fallbacks[targetLocale];
  }

  if (locales[targetLocale]) {
    return locales[targetLocale];
  } else {
    logWarn(&#x27;No catalog found for &#x22;&#x27; + targetLocale + &#x27;&#x22;&#x27;);
    return false;
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```js
getLocale(); // --&#x3e; de
getLocale(req); // --&#x3e; de
req.getLocale(); // --&#x3e; de
```

### i18n.<span class="apidocCodeKeywordSpan">getCatalog</span>()

Returns a whole catalog optionally based on current scope and locale.

```js
getCatalog(); // returns all locales
getCatalog(&#x27;de&#x27;); // returns just &#x27;de&#x27;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.i18n.getLocale" id="apidoc.element.i18n.getLocale">
        function <span class="apidocSignatureSpan">i18n.</span>getLocale
        <span class="apidocSignatureSpan">(request)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function i18nGetLocale(request) {

  // called like i18n.getLocale(req)
  if (request &#x26;&#x26; request.locale) {
    return request.locale;
  }

  // called like req.getLocale()
  return this.locale || defaultLocale;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

or disable inheritance by passing true as third parameter:

```js
i18n.setLocale(res, &#x27;ar&#x27;, true); // --&#x3e; req: Hallo res: مرحبا res.locals: Hallo
```

### i18n.<span class="apidocCodeKeywordSpan">getLocale</span>()

Getting the current locale (ie.: `en`) from current scope or globally.

```js
getLocale(); // --&#x3e; de
getLocale(req); // --&#x3e; de
req.getLocale(); // --&#x3e; de
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.i18n.getLocales" id="apidoc.element.i18n.getLocales">
        function <span class="apidocSignatureSpan">i18n.</span>getLocales
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function i18nGetLocales() {
  return Object.keys(locales);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    * __fixed__: typos, missing and wrong docs, plural bugs like: #210, #191, #190
* 0.7.0:
    * __improved__: `i18n.setLocale()` and `i18n.init()` refactored to comply with most common use cases, much better test coverage
 and docs
    * __new__: options: `autoReload`, `directoryPermissions`, `register`, `queryParameter`, read locales from filenames with empty
 `locales` option (#134)
    * __fixed__: typos, missing and wrong docs, issues related to `i18n.setLocale()`
* 0.6.0:
    * __improved__: Accept-Language header parsing to ICU, delimiters with object notation, jshint, package.json, README;
    * __new__: prefix for locale files, `i18n.<span class="apidocCodeKeywordSpan">getLocales</span>()`, custom logger, fallback[
s];
    * __fixed__: typos, badges, plural (numbers), `i18n.setLocale()` for `req` _and_ `res`
* 0.5.0: feature release; added {{mustache}} parsing by #85, added &#x22;object.notation&#x22; by #110, fixed buggy req.__() implementation
 by #111 and closed 13 issues
* 0.4.1: stable release; merged/closed: #57, #60, #67 typo fixes; added more examples and new features: #53, #65, #66 - and some
 more api reference
* 0.4.0: stable release; closed: #22, #24, #4, #10, #54; added examples, clarified concurrency usage in different template engines
, added `i18n.getCatalog`
* 0.3.9: express.js usage, named api, jscoverage + more test, refactored configure, closed: #51, #20, #16, #49
* 0.3.8: fixed: #44, #49; merged: #47, #45, #50; added: #33; updated: README
* 0.3.7: tests by mocha.js, added `this.locale` to `__` and `__n`
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.i18n.init" id="apidoc.element.i18n.init">
        function <span class="apidocSignatureSpan">i18n.</span>init
        <span class="apidocSignatureSpan">(request, response, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function i18nInit(request, response, next) {
  if (typeof request === &#x27;object&#x27;) {

    // guess requested language/locale
    guessLanguage(request);

    // bind api to req
    applyAPItoObject(request);

    // looks double but will ensure schema on api refactor
    i18n.setLocale(request, request.locale);
  } else {
    return logError(&#x27;i18n.init must be called with one parameter minimum, ie. i18n.init(req)&#x27;);
  }

  if (typeof response === &#x27;object&#x27;) {
    applyAPItoObject(response);

    // and set that locale to response too
    i18n.setLocale(response, request.locale);
  }

  // head over to next callback when bound as middleware
  if (typeof next === &#x27;function&#x27;) {
    return next();
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

In case of cookie you will also need to enable cookies for your application. For express this done by adding `app.use(express.cookieParser
())`). Now use the same cookie name when setting it in the user preferred language, like here:

```js
res.cookie(&#x27;yourcookiename&#x27;, &#x27;de&#x27;, { maxAge: 900000, httpOnly: true });
```

After this and until the cookie expires, `i18n.<span class="apidocCodeKeywordSpan">init</span>()` will get the value of the cookie
 to set that language instead of default for every page.

#### Some words on `register` option

Esp. when used in a cli like scriptyou won&#x27;t use any `i18n.init()` to guess language settings from your user. Thus `i18n` won
&#x27;t bind itself to any `res` or `req` object and will work like a static module.

```js
var anyObject = {};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.i18n.removeLocale" id="apidoc.element.i18n.removeLocale">
        function <span class="apidocSignatureSpan">i18n.</span>removeLocale
        <span class="apidocSignatureSpan">(locale)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function i18nRemoveLocale(locale) {
  delete locales[locale];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.i18n.setLocale" id="apidoc.element.i18n.setLocale">
        function <span class="apidocSignatureSpan">i18n.</span>setLocale
        <span class="apidocSignatureSpan">(object, locale, skipImplicitObjects)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function i18nSetLocale(object, locale, skipImplicitObjects) {

  // when given an array of objects =&#x3e; setLocale on each
  if (Array.isArray(object) &#x26;&#x26; typeof locale === &#x27;string&#x27;) {
    for (var i = object.length - 1; i &#x3e;= 0; i--) {
      i18n.setLocale(object[i], locale, true);
    }
    return i18n.getLocale(object[0]);
  }

  // defaults to called like i18n.setLocale(req, &#x27;en&#x27;)
  var targetObject = object;
  var targetLocale = locale;

  // called like req.setLocale(&#x27;en&#x27;) or i18n.setLocale(&#x27;en&#x27;)
  if (locale === undefined &#x26;&#x26; typeof object === &#x27;string&#x27;) {
    targetObject = this;
    targetLocale = object;
  }

  // consider a fallback
  if (!locales[targetLocale] &#x26;&#x26; fallbacks[targetLocale]) {
    targetLocale = fallbacks[targetLocale];
  }

  // now set locale on object
  targetObject.locale = locales[targetLocale] ? targetLocale : defaultLocale;

  // consider any extra registered objects
  if (typeof register === &#x27;object&#x27;) {
    if (Array.isArray(register) &#x26;&#x26; !skipImplicitObjects) {
      register.forEach(function(r) {
        r.locale = targetObject.locale;
      });
    } else {
      register.locale = targetObject.locale;
    }
  }

  // consider res
  if (targetObject.res &#x26;&#x26; !skipImplicitObjects) {

    // escape recursion
    // @see  - https://github.com/balderdashy/sails/pull/3631
    //       - https://github.com/mashpie/i18n-node/pull/218
    if (targetObject.res.locals) {
      i18n.setLocale(targetObject.res, targetObject.locale, true);
      i18n.setLocale(targetObject.res.locals, targetObject.locale, true);
    } else {
      i18n.setLocale(targetObject.res, targetObject.locale);
    }
  }

  // consider locals
  if (targetObject.locals &#x26;&#x26; !skipImplicitObjects) {

    // escape recursion
    // @see  - https://github.com/balderdashy/sails/pull/3631
    //       - https://github.com/mashpie/i18n-node/pull/218
    if (targetObject.locals.res) {
      i18n.setLocale(targetObject.locals, targetObject.locale, true);
      i18n.setLocale(targetObject.locals.res, targetObject.locale, true);
    } else {
      i18n.setLocale(targetObject.locals, targetObject.locale);
    }
  }

  return i18n.getLocale(targetObject);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var anyObject = {};

i18n.configure({
  locales: [&#x27;en&#x27;, &#x27;de&#x27;],
  register: anyObject
});

anyObject.<span class="apidocCodeKeywordSpan">setLocale</span>(&#x27;de&#x27;);
anyObject.__(&#x27;Hallo&#x27;); // --&#x3e; Hallo`
```

Cli usage is a special use case, as we won&#x27;t need to maintain any transaction / concurrency aware setting of locale, so you
 could even choose to bind `i18n` to _global_ scope of node:

```js
i18n.configure({
...</pre></li>
    </ul>






</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
